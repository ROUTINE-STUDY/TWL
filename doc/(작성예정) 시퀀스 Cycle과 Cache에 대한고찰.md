

# 📌 시퀀스(Sequence)란?

시퀀스는 유일한 값을 생성해주는 오라클 객체이다. 자동 일련번호를 생성하는 Object

오라클에서는 자동 증가 컬럼을 사용할 수가 없다. 다른 DB에서는 컬럼 자체에 옵션이 있으나, 오라클에서는 컬럼의 값을 증가시키기 위해서는 **MAX(컬럼) + 1** 또는 **시퀀스**를 사용하여 일련번호를 부여해야 한다.

# 📌 시퀀스내 Cycle 옵션은?

최대값 또는 최소값에 도달한 후에도 시퀀스가 ​​계속해서 값을 생성함을 나타내려면 지정합니다 . 

오름차순 시퀀스는 최대값에 도달한 후 최소값을 생성합니다. 내림차순 시퀀스가 ​​최소값에 도달한 후 최대값을 생성합니다.

```
// MAXVALUE = 5 인 시퀀스 -> 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 3, 4, 5
```

# 📌 시퀀스 내 캐시(Cache)란?

더 빠른 액세스를 위해 데이터베이스가 사전 할당하고 메모리에 유지하는 시퀀스 값 수를 지정합니다. 이 정수 값은 28자 이하일 수 있습니다.

```
// MIN = 1, MAX = 10, CACHE = 3 인 시퀀스
현재 값 : 2
캐시 메모리 : 3, 4, 5

seq.nextval()

현재 값 : 3
캐시 메모리 : 4, 5, 6
```



간단한게 시퀀스에 대해 알아보았다.

시퀀스에 생성 및 사용 방법에 대해 논의하고자 하는건 아니기 때문에 기본적인 설명은 생략한다. (오라클 공식문서 확인)



# ❓ 퀴즈

아래의 시퀀스 생성은 성공할까요?

```sql
CREATE SEQUENCE seq_no 
START WITH 1
INCREMENT BY 2
MAXVALUE 5 
MINVALUE 1
CYCLE 
CACHE 3;
```



Oracle Live SQL → Oracle Live SQL





위 처럼 시퀀스를 생성하려고하면 ORA-04013 에러가 발생합니다.

" **ORA-04013: number to CACHE must be less than one cycle** 



→ 직역하면 캐시의 수는 한 사이클 보다 적어야 합니다.   왜?



```
시작값 : 1
최소값 : 1
최대값 : 5
증가값 : 2
CYCLE : O
CACHE : 3
```

위 시퀀스가 가질 수 있는 값은 1, 3, 5, 1, 3, 5, 1, 3, 5 .. '1', '3', '5' 즉 3개 뿐이다.

그런데 캐시 사이즈가 3이라면 위 시퀀스의 사이클인 3개의 값은 계속 캐시 메모리를 점유할 것이고, 사실상 무한 캐시를 진행하게 된다. 그렇다면 한정된 캐시 메모리에 무한한 점유가 가능하고, 이를 오라클에서 제한한 것이라고 추측하고 있다.

공식 문서에 따르면 아래의 공식이 Cycle 시퀀스에 캐시 사이즈의 최대치를 의미한다

```sql
 CEIL ( (MAXVALUE - MINVALUE) / ABS (INCREMENT) )
```

위 공식을 적용하면 (5 - 1) / 2 = 2 가 나오고, 해당 구조의 시퀀스의 최대 캐시 사이즈는 2 이다.



추가로 캐시의 최소값은 1이아니라 2인데, 이는 캐시 사용의 목적에 이유가 있다고 생각한다.

캐시는 본래 일정한 공간을 할당하여 빠른 속도로 접근하기 위함인데, 1개의 공간만 사용한다면 사용할 때마다 다시 캐시 메모리에 재할당해야한다. 

CYCLE 시퀀스에서 많은 캐시 사용, 1개의 캐시 사용은 일반적으로 비효율적인 캐시 메모리의 사용이 아닐까 싶다.

그래서 똑똑한 오라클 개발자 분들이 예외 처리를 하지 않았을까..? 하하 정도로 정리된다.



특별히 중요한 개념까지는 아닌 것 같지만, 그래도 이런 주제는 흥미롭다.





참조 → Oracle 공식문서 - 시퀀스 stackOverflow - 캐시 관련 내용

