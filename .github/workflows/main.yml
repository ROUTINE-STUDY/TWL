name: GitHub Actions Demo
on: 
  workflow_dispatch:
  push:
  repository_dispatch:
    types: [coda-event]  
jobs:
  request-export-doc:
    runs-on: ubuntu-latest
    env:
      PYTHONPATH: /home/runner/work/TWL/TWL/SyncCodaAndGithub/python

    steps:
      - name: 현재 디렉터리 위치 출력
        run: pwd
      - name: 현재 디렉터리 내용 출력
        run: ls -al
      - name: Check out repository code
        # {소유자}/{저장소명}@{참조자(버전)}
        uses: actions/checkout@v2
      - name: action 사용 후에 내용 출력
        run: ls -al
      - name: API Key 출력
        run: echo ${{secrets.CODA_API_KEY}}
      - name: PYTHON 경로 확인
        run: echo $PYTHONPATH
      - name: python3 SyncCodaAndGithub/python/main/entry_point.py ${{secrets.CODA_API_KEY}}
        working-directory: ./SyncCodaAndGithub/python/main
        run: python3 entry_point.py ${{secrets.CODA_API_KEY}}

  test:
    runs-on: ubuntu-latest
    env:
      PYTHONPATH: /home/runner/work/TWL/TWL/SyncCodaAndGithub/python
    steps:
      - name: 현재 디렉터리 위치 출력
        run: pwd
      - name: 현재 디렉터리 내용 출력
        run: ls -al
      - name: Check out repository code
        # {소유자}/{저장소명}@{참조자(버전)}
        uses: actions/checkout@v2
      - name: action 사용 후에 내용 출력
        run: ls -al
      - name: End to End test
        working-directory: ./SyncCodaAndGithub/python/test
        run: python3 -m unittest -k TestCodaAPIEndToEnd test_coda_api.py